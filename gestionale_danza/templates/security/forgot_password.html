{% extends "auth_base.html" %}

{% block auth_content %}
<div class="row w-100 justify-content-center">
    <div class="col-xl-10 col-lg-11">
        <div class="auth-card">
            <div class="row g-0">
                <!-- Logo Section -->
                <div class="col-lg-5">
                    <div class="logo-section h-100">
                        <div class="position-relative z-1">
                            {% if global_settings and global_settings.logo_filename %}
                            <div class="company-logo">
                                <img src="{{ url_for('static', filename='uploads/' + global_settings.logo_filename) }}" 
                                     alt="{{ global_settings.denominazione_sociale }}" 
                                     style="max-height: 80px; max-width: 200px; object-fit: contain; margin-bottom: 15px;">
                            </div>
                            <h1 class="company-name">{{ global_settings.denominazione_sociale }}</h1>
                            {% else %}
                            <div class="logo-icon">
                                <i class="bi bi-music-note-beamed"></i>
                            </div>
                            <h1 class="company-name">Dance2Manage</h1>
                            {% endif %}
                            <p class="company-tagline">Recupera il tuo accesso alla piattaforma</p>
                            
                            <ul class="feature-list">
                                <li class="feature-item">
                                    <i class="bi bi-shield-check"></i>
                                    <span>Sistema sicuro di recupero password</span>
                                </li>
                                <li class="feature-item">
                                    <i class="bi bi-envelope-check"></i>
                                    <span>Istruzioni inviate via email</span>
                                </li>
                                <li class="feature-item">
                                    <i class="bi bi-clock-history"></i>
                                    <span>Link di reset temporaneo</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Form Section -->
                <div class="col-lg-7">
                    <div class="form-section h-100">
                        <div class="auth-form">
                            <div class="text-center mb-4">
                                <h2 class="auth-title">Password Dimenticata?</h2>
                                <p class="auth-subtitle">Inserisci la tua email per ricevere le istruzioni di recupero</p>
                            </div>

                            {% include "security/_messages.html" %}

                            <form method="POST" id="forgot-form" class="needs-validation" novalidate>
                                {{ forgot_password_form.hidden_tag() }}
                                
                                <div class="form-floating mb-4">
                                    {{ forgot_password_form.email(class="form-control form-control-lg", 
                                       placeholder="nome@esempio.it", 
                                       required=true,
                                       id="email") }}
                                    <label for="email">
                                        <i class="bi bi-envelope me-2"></i>Email
                                    </label>
                                    <div class="invalid-feedback">
                                        Inserisci un indirizzo email valido
                                    </div>
                                </div>

                                <div class="d-grid mb-4">
                                    {{ forgot_password_form.submit(class="btn btn-auth btn-lg") }}
                                </div>

                                <div class="auth-links text-center">
                                    <p class="mb-2">Ti sei ricordato la password?</p>
                                    <a href="{{ url_for('security.login') }}" class="auth-link">
                                        <i class="bi bi-arrow-left me-1"></i>
                                        Torna al Login
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgot-form');
    const emailInput = document.getElementById('email');
    
    // Form validation
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });
    
    // Email input focus effects
    emailInput.addEventListener('focus', function() {
        this.parentElement.classList.add('input-focused');
    });
    
    emailInput.addEventListener('blur', function() {
        if (!this.value) {
            this.parentElement.classList.remove('input-focused');
        }
    });
    
    // Auto-focus on email field
    emailInput.focus();
});
</script>
{% endblock %}